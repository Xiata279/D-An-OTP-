<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LuânEm v5.5 - Async Engine</title>
    <meta name="description" content="LuânEm v5.5 - Async OTP Engine with AI Smart Retry">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}?v=5.5">
</head>

<body>
    <canvas id="matrixCanvas"
        style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;pointer-events:none;"></canvas>
    <div class="mesh-background"></div>
    <div class="aurora"></div>
    <div class="grid-overlay"></div>

    <div class="bento-container">
        <!-- Header -->
        <div class="header">
            <div class="brand">
                <div class="logo-box"><i class="fa-solid fa-satellite-dish"></i></div>
                <div class="brand-text">
                    <h1>LUÂN EM <span class="badge async-badge"> ASYNC</span></h1>
                    <p class="tagline">Chưa tài đâu</p>
                </div>
            </div>
            <div class="header-actions">
                <button id="themeToggle" onclick="toggleTheme()" class="icon-btn" title="Theme">
                    <i class="fa-solid fa-sun"></i>
                </button>
                <div class="status-indicator">
                    <span class="dot"></span> ONLINE
                </div>
            </div>
        </div>

        <div class="main-grid">
            <!-- Left: Controls -->
            <div class="controls bento-item">
                <h2><i class="fa-solid fa-crosshairs"></i> BẢNG ĐIỀU KHIỂN</h2>

                <div class="input-group">
                    <label>MỤC TIÊU</label>
                    <div class="holo-input">
                        <i class="fa-solid fa-phone"></i>
                        <input type="tel" id="phoneInput" placeholder="0901234567" maxlength="11"
                            oninput="detectCarrier(this.value)">
                        <span id="carrierBadge" class="carrier-badge">NET</span>
                    </div>
                </div>

                <div class="control-row" style="margin-top:15px;">
                    <div class="input-group">
                        <label>ĐỘ TRỄ <span id="delayValue" class="hl">2.0s</span></label>
                        <input type="range" id="delaySlider" min="0.5" max="10" step="0.5" value="2">
                    </div>
                    <div class="input-group">
                        <label>LUỒNG <span id="threadValue" class="hl">1</span></label>
                        <input type="range" id="threadSlider" min="1" max="20" step="1" value="1">
                    </div>
                </div>

                <!-- Attack Mode -->
                <div class="input-group" style="margin-top:15px;">
                    <label>CHẾ ĐỘ TẤN CÔNG</label>
                    <div class="mode-selector three-col">
                        <label class="mode-option active">
                            <input type="radio" name="mode" value="carpet" checked id="attackMode">
                            <span><i class="fa-solid fa-bomb"></i> CARPET</span>
                        </label>
                        <label class="mode-option">
                            <input type="radio" name="mode" value="sniper">
                            <span><i class="fa-solid fa-crosshairs"></i> SNIPER</span>
                        </label>
                        <label class="mode-option">
                            <input type="radio" name="mode" value="turbo">
                            <span class="turbo-span"><i class="fa-solid fa-rocket"></i> TURBO</span>
                        </label>
                    </div>
                </div>

                <!-- Auto Proxy -->
                <div class="input-group checkbox-group" style="margin-top:15px;">
                    <label for="autoProxy" class="checkbox-label">
                        <input type="checkbox" id="autoProxy">
                        <span class="checkmark"></span>
                        <i class="fa-solid fa-globe"></i> AUTO PROXY
                    </label>
                </div>

                <!-- Buttons -->
                <div class="action-grid" style="margin-top:20px;">
                    <button id="btnStart" class="holo-btn start" onclick="startSpam()">
                        <i class="fa-solid fa-bolt"></i> BẮT ĐẦU
                    </button>
                    <button id="btnStop" class="holo-btn stop" onclick="stopSpam()" disabled>
                        <i class="fa-solid fa-power-off"></i> DỪNG
                    </button>
                </div>

                <div class="divider"></div>

                <!-- Sub Controls -->
                <div class="sub-controls">
                    <a href="/proxies" class="btn-icon" title="Proxy">
                        <i class="fa-solid fa-shield-cat"></i>Proxy <span id="proxyStatus" class="mini-badge">0</span>
                    </a>
                    <a href="/health" class="btn-icon health-btn" title="Health">
                        <i class="fa-solid fa-heart-pulse"></i>Health
                    </a>
                    <button class="btn-icon" onclick="showAIStats()" title="AI Brain">
                        <i class="fa-solid fa-brain"></i>AI
                    </button>
                    <button id="btnGhost" class="btn-icon ghost" onclick="activateGhostMode()" title="Ghost">
                        <i class="fa-solid fa-ghost"></i>Ghost
                    </button>
                    <button class="btn-icon" onclick="openTelegramModal()" title="Telegram">
                        <i class="fa-brands fa-telegram"></i>Tele
                    </button>
                </div>
            </div>

            <!-- Right: Monitor -->
            <div class="monitor-column">
                <!-- Terminal -->
                <div class="bento-item logs">
                    <div class="log-header">
                        <h2><i class="fa-solid fa-terminal"></i> TERMINAL</h2>
                        <div style="display:flex;align-items:center;gap:10px;">
                            <span id="elapsedTimer" class="elapsed-timer">00:00</span>
                            <div class="window-controls"><span></span><span></span><span></span></div>
                        </div>
                    </div>
                    <div class="log-content" id="logConsole">
                        <div class="log-line system">>> LuânEm v5.5 ASYNC Engine Ready</div>
                        <div class="log-line system">>> AI Smart Retry: ENABLED</div>
                        <div class="log-line system">>> aiohttp Concurrent: ENABLED</div>
                    </div>
                </div>

                <!-- Stats -->
                <div class="stats-row">
                    <div class="stat-card sent">
                        <div class="stat-icon"><i class="fa-solid fa-paper-plane"></i></div>
                        <div class="stat-data">
                            <span class="stat-value" id="statsSent">0</span>
                            <span class="stat-label">ĐÃ GỬI</span>
                        </div>
                    </div>
                    <div class="stat-card success">
                        <div class="stat-icon"><i class="fa-solid fa-check-double"></i></div>
                        <div class="stat-data">
                            <span class="stat-value" id="statsSuccess">0</span>
                            <span class="stat-label">OK</span>
                        </div>
                    </div>
                    <div class="stat-card fail">
                        <div class="stat-icon"><i class="fa-solid fa-xmark"></i></div>
                        <div class="stat-data">
                            <span class="stat-value" id="statsFail">0</span>
                            <span class="stat-label">FAIL</span>
                        </div>
                    </div>
                    <div class="stat-card rate">
                        <div class="stat-icon"><i class="fa-solid fa-percent"></i></div>
                        <div class="stat-data">
                            <span class="stat-value" id="successRate">--</span>
                            <span class="stat-label">TỶ LỆ</span>
                        </div>
                    </div>
                    <div class="stat-card speed">
                        <div class="stat-icon"><i class="fa-solid fa-gauge-high"></i></div>
                        <div class="stat-data">
                            <span class="stat-value" id="speedRate">0/m</span>
                            <span class="stat-label">TỐC ĐỘ</span>
                        </div>
                    </div>
                </div>

                <!-- Visualizer -->
                <div class="visualizer-box">
                    <div class="vis-bar"></div>
                    <div class="vis-bar"></div>
                    <div class="vis-bar"></div>
                    <div class="vis-bar"></div>
                    <div class="vis-bar"></div>
                    <div class="vis-bar"></div>
                    <div class="vis-bar"></div>
                    <div class="vis-bar"></div>
                    <div class="vis-bar"></div>
                    <div class="vis-bar"></div>
                    <div class="vis-bar"></div>
                    <div class="vis-bar"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Telegram Modal -->
    <div id="telegramModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeTelegramModal()">&times;</span>
            <h2><i class="fa-brands fa-telegram"></i> Telegram</h2>
            <div class="input-group">
                <label>Bot Token</label>
                <div class="holo-input"><input type="text" id="teleToken" placeholder="Token..."></div>
            </div>
            <div class="input-group">
                <label>Chat ID</label>
                <div class="holo-input"><input type="text" id="teleChatId" placeholder="ID..."></div>
            </div>
            <button class="holo-btn start" onclick="saveTelegramConfig()" style="margin-top:20px;width:100%;">
                <i class="fa-solid fa-save"></i> LƯU
            </button>
        </div>
    </div>

    <!-- AI Stats Modal -->
    <div id="aiModal" class="modal" onclick="if(event.target===this)closeAIModal()">
        <div class="modal-content ai-modal">
            <span class="close" onclick="closeAIModal()">&times;</span>
            <h2><i class="fa-solid fa-brain"></i> AI SMART RETRY</h2>
            <p class="modal-desc">Điểm thích ứng của AI cho từng service. Điểm cao = ưu tiên gửi, điểm thấp = auto
                cooldown.</p>
            <div id="aiStatsBody" class="ai-stats-body">
                <div class="ai-row"><span class="ai-name">Chưa có dữ liệu...</span></div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}?v=5.5"></script>
    <script>
        // Attack Mode selector
        document.querySelectorAll('.mode-option input').forEach(radio => {
            radio.addEventListener('change', function () {
                document.querySelectorAll('.mode-option').forEach(o => o.classList.remove('active'));
                this.closest('.mode-option').classList.add('active');
                document.getElementById('attackMode').value = this.value;
            });
        });
    </script>
</body>

</html>